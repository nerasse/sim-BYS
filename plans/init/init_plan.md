## üé∞ Projet : Simulation de Machine √† Sous (Slot Game Simulator)

### üéØ Objectif

Cr√©er une application interactive qui simule un mini-jeu de machine √† sous.  
L'utilisateur peut :

- Configurer les param√®tres de base du slot (valeurs, taux d'apparition, multiplicateurs, connexions, etc.)
- Ajouter et activer/d√©sactiver des objets qui modifient les multiplicateurs et probabilit√©s
- Lancer une simulation de plusieurs spins pour observer les r√©sultats, les moyennes et les extr√™mes

---

### ‚öôÔ∏è Structure de l'application

L'app doit comporter 3 onglets principaux :

1. **Param√®tres de base**
   - Gestion des symboles et de leurs propri√©t√©s :
     - Valeur de base
     - Pourcentage d'apparition
   - Il y a 8 symboles normaux : 10, J, Q, K, A, P1 (Premium 1), P2 (Premium 2), P3 (Premium 3)
   - 1 symbole Bonus (B) (s'active si 3 apparaissent)
   - D√©finition du poids des symboles : 
     - 10 =17%
     - J =17%
     - Q =14%
     - K =14%
     - A = 14%
     - P1 =12.33%
     - P2 =12.33%
     - P3 = 12.33%
     - B = 1% 
     - A
   - **Param√®tre : % minimum pour le Bonus (par d√©faut 1%)**
   - Grid : 5x3
   - 11 types de connexions (horizontal, vertical, diagonal, zigzag, patate, V, V invers√©, full grid, etc.)
   - Voici les diff√©rentes connexions possibles avec 10 comme exemple de symbole

     oeil (Oeil):

     |    |    |    |    |    |
     |----|----|----|----|----|
     |    | 10 | 10 | 10 |    |
     | 10 | 10 |    | 10 | 10 |
     |    | 10 | 10 | 10 |    |

     triangle en haut (Tri)

     |    |    |    |    |    |
     |----|----|----|----|----|
     | 10 | 10 | 10 | 10 | 10 |
     |    | 10 |    | 10 |    |
     |    |    | 10 |    |    |

     V en bas (V bis)

     |    |    |    |    |     |
     |----|----|----|----|-----|
     |    |    | 10 |    |     |
     |    | 10 |    | 10 |     |
     | 10 |    |    |    | /10 |

     Triangle (Tri)

     |    |    |    |    |    |
     |----|----|----|----|----|
     |    |    | 10 |    |    |
     |    | 10 |    | 10 |    |
     | 10 | 10 | 10 | 10 | 10 |

     Horizontal 3 (H3)

     |    |    |    |
     |----|----|----|
     | 10 | 10 | 10 |

     Horizontal 4 (H4)

     |    |    |    |    |
     |----|----|----|----|
     | 10 | 10 | 10 | 10 |

     V (V)

     |    |    |    |    |    |
     |----|----|----|----|----|
     | 10 |    |    |    | 10 |
     |    | 10 |    | 10 |    |
     |    |    | 10 |    |    |

     Horizontal 5 (H5)

     |    |    |    |    |    |
     |----|----|----|----|----|
     | 10 | 10 | 10 | 10 | 10 |

     Diagonal 3 (D3)

     |    |    |    |
     |----|----|----|
     | 10 |    |    |
     |    | 10 |    |
     |    |    | 10 |

     Vertical 3 (V3)

   |    |
   |----|
   | 10 |
   | 10 |
   | 10 |

   Jackpot (J)

   |    |    |    |    |    |
   |----|----|----|----|----|
   | 10 | 10 | 10 | 10 | 10 |
   | 10 | 10 | 10 | 10 | 10 |
   | 10 | 10 | 10 | 10 | 10 |


  - **R√®gles de combinaisons (D√âDUPLICATION - Des petites vers les grandes)**
  - \- **PRINCIPE** : Chaque symbole ne peut √™tre compt√© QU'UNE SEULE FOIS. On commence par d√©tecter les petites combis, puis on cherche les grandes avec les symboles restants.
  
  - **CAS SP√âCIAL - JACKPOT** :
         - **Jackpot (J)** = EXCEPTION - CUMULE TOUT
         - Si la grille compl√®te (5√ó3 = 15 cases) est remplie d'un seul symbole ‚Üí JACKPOT !
         - **C'est la seule combinaison qui cumule toutes les autres**
         - D√©clenche TOUTES les combinaisons possibles pr√©sentes (Oeil, Tri, V bis, V, tous les H5, H4, H3, V3, D3)
         - + Multiplicateur bonus du Jackpot
         - **Gain = Somme de toutes les combinaisons + Bonus Jackpot**
  
  - **ORDRE DE D√âTECTION** (des petites vers les grandes) :
         
         **√âtape 1 : D√©tecter les combinaisons de base (3 symboles)**
         - **H3** (3 symboles horizontaux align√©s)
         - **V3** (3 symboles verticaux align√©s)
         - **D3** (3 symboles en diagonale)
         - Pour chaque combinaison d√©tect√©e : compter le gain et marquer les 3 symboles comme "utilis√©s"
         
         **√âtape 2 : D√©tecter H4 avec les symboles restants**
         - **H4** (4 symboles horizontaux align√©s)
         - Si tous les 4 symboles sont encore disponibles ‚Üí compter H4 et marquer comme "utilis√©s"
         - Sinon ‚Üí ignorer (d√©j√† compt√© en H3 √† l'√©tape 1)
         
         **√âtape 3 : D√©tecter H5 avec les symboles restants**
         - **H5** (5 symboles horizontaux align√©s)
         - Si tous les 5 symboles sont encore disponibles ‚Üí compter H5 et marquer comme "utilis√©s"
         - Sinon ‚Üí ignorer (d√©j√† compt√© en H3/H4 aux √©tapes pr√©c√©dentes)
         
         **√âtape 4 : D√©tecter V avec les symboles restants**
         - **V** (pattern en V)
         - Si tous les symboles du V sont encore disponibles ‚Üí compter V et marquer comme "utilis√©s"
         - Sinon ‚Üí ignorer
         
         **√âtape 5 : D√©tecter V bis avec les symboles restants**
         - **V bis** (V invers√©)
         - Si tous les symboles du V bis sont encore disponibles ‚Üí compter V bis et marquer comme "utilis√©s"
         - Sinon ‚Üí ignorer
         
         **√âtape 6 : D√©tecter Triangle avec les symboles restants**
         - **Tri** (pattern triangle)
         - Si tous les symboles du Tri sont encore disponibles ‚Üí compter Tri et marquer comme "utilis√©s"
         - Sinon ‚Üí ignorer
         
         **√âtape 7 : D√©tecter Oeil avec les symboles restants**
         - **Oeil** (pattern oeil)
         - Si tous les symboles de l'Oeil sont encore disponibles ‚Üí compter Oeil et marquer comme "utilis√©s"
         - Sinon ‚Üí ignorer
  
  - **R√âSUM√â DE L'ALGORITHME** :
         1. V√©rifier d'abord si Jackpot (full grid) ‚Üí si oui, cumul TOUT et stop
         2. Sinon, d√©tecter dans l'ordre : H3/V3/D3 ‚Üí H4 ‚Üí H5 ‚Üí V ‚Üí V bis ‚Üí Tri ‚Üí Oeil
         3. Pour chaque combinaison : si tous ses symboles sont disponibles, la compter et marquer les symboles comme utilis√©s
         4. Gain total = somme de toutes les combinaisons d√©tect√©es

   
   - Gestion des multiplicateurs g√©n√©rale par type de connexion
   - Chaque entr√©e doit avoir une note d'aide indiquant ce qu'elle fait
   - **Les pourcentages d'apparition sont toujours normalis√©s √† 100% :**
     - Dans l'interface utilisateur : modifier un symbole ajuste automatiquement les autres pour garder 100% total
     - Avec les effets d'objets : **l'ajout est litt√©ral (+10% = vraiment +10% affich√©), les autres perdent proportionnellement**
     - **Le symbole Bonus garde toujours minimum 1% (param√©trable dans l'interface)**
     - Si un symbole atteint ‚â•100%, tous les autres tombent √† 0% (sauf Bonus √† 1%)
     - L'affichage montre toujours le % r√©el apr√®s application des effets
   - On start avec 1% de chance (100% = jackpot avec un cap √† 90%)
2. **Objets**
   - Possibilit√© d'ajouter dynamiquement des objets via un bouton "Ajouter un objet"
   - Chaque objet a : 
     - Un nom
     - Une case "Activer/D√©sactiver"
     - Un effet (s√©lectionnable dans un menu d√©roulant)
     - D√©finir le ou les symbole(s) affect√©(s) (option pour les symboles premiums ou non) (option pour tout affect√© en 1 clic)
     - D√©finir la valeur de l'effet sur le(s) symbole(s)
     - Les objets sont toujours √©ditables
     - Connexions affect√©es (possibilit√© de tout affecter en 1 clic)
     - Un pourcentage d'apparition de l'effet (pas tout le temps)
     - Effets sur le nombre de spins (+ou- x spin)
   - Un helper (petit panneau explicatif) d√©crivant ce que chaque multiplicateur ou effet fait (le calcul si possible)
   - **Afficher les nouvelles valeurs √† jour apr√®s l'application des effets d'objet :**
     - Afficher le POIDS (valeur brute apr√®s effets)
     - Afficher le % R√âEL (pourcentage calcul√© par rapport au total des poids)
     - Formule : % R√©el = (Poids du symbole / Somme de tous les poids) √ó 100
   - Liste des effets: 
     - Ajouter/multiplier/soustraire le POIDS d'apparition (min 0, pas de max - devient un poids de probabilit√©)
     - Ajouter/multiplier/soustraire la valeur de base (min 0)
     - Ajouter/multiplier/soustraire la chance globale (qui est g√©n√©rale, max 90%)
3. **Simulation**
   - Entr√©es utilisateur : 
     - Nombre de tours (√©ch√©ances)
     - Nombre de spins par tour (par d√©faut : 5)
     - D√©finir le montant de l'√©ch√©ance de base (par d√©faut : 100)
     - Multiplicateur d'√©ch√©ance (par d√©faut : "10x" √† la suivante)
   - Bouton "Lancer la simulation" qui lance la simulation
   - Bouton "Ech√©ance suivante" qui permet de passer √† l'√©ch√©ance suivante et de faire une simulation sur la next s√©rie de 5√ó3 = 15 spins
   - Affichage de la simulation: 
     - √âchec ou r√©ussite de l'√©ch√©ance
     - Un graph pour visualiser la r√©partition des essais par rapport aux gains
     - Simulation de 1000 essais ‚Üí affiche moyenne, min et max
     - Aper√ßu des 3 meilleurs essais complets et aussi des 3 pires et 3 moyens
     - Chaque essai = 15 spins, mais par jet de 5 spins pour 3 tour
     - Pour chaque spin on doit voir :
       - Affiche les 15 grilles (5√ó3)
       - Nombre de combinaisons
       - r√©sultats obtenus
       - Indicateur tour bonus en cours
       - Afficher le pourcentage de chance sur les spins
   - Les bonus : 
     - Si 3 symboles bonus apparaissent alors les 2 prochains tours sont en bonus (+2 spins gratuits suppl√©mentaires) ex : sur un jet de 5 spins, si on a un bonus, √ßa fera un nombre total de 7 spins
     - Sous bonus, la chance augmente de +50% cap √† 90%
     - Sous bonus, les symboles bonus deviennent des WILDS (W) qui connectent avec n‚Äôimporte quel symbole et ne rajoutent aucun spin suppl√©mentaire
   - "Chance = 100%" = Jackpot (full grille avec un seul symbole)

---

### üîß Gestion des probabilit√©s (SIMPLE ET DIRECT)

**Un seul mode de calcul :**

1. **Mode Interface (Param√®tres de base)** :
   - Normalisation automatique pour garder 100% total
   - Modifier un symbole redistribue proportionnellement aux autres
   - UX simple et intuitive pour l'utilisateur
2. **Mode avec objets actifs** :
   - **L'ajout est LITT√âRAL : +10% = vraiment +10% affich√©**
   - Les autres symboles perdent proportionnellement pour compenser
   - **R√àGLE SP√âCIALE : Le symbole Bonus garde toujours minimum 1% (param√©trable)**
   - Si un symbole atteint ou d√©passe 100% ‚Üí tous les autres tombent √† 0% (sauf Bonus √† 1% minimum)

   **Formule de r√©duction des autres :**

   ```
   Symbole boost√© : +X% ‚Üí garde exactement +X%
   Montant √† retirer total : X%
   
   Pour chaque autre symbole (sauf Bonus) :
     perte = X √ó (son_% / somme_des_autres_%)
     nouveau_% = max(0, ancien_% - perte)
   
   Bonus : toujours >= 1% (ou valeur param√©trable)
   ```
3. **Ordre d'application des objets** :
   - Les objets s'appliquent dans l'ordre de la liste
   - Possibilit√© de r√©organiser les objets (boutons ‚Üë‚Üì)

---

### üí° Exemples concrets

**Exemple 1 : Boost normal**

```
Initial : Tous les symboles √† 11.11% (9 symboles)
Objet 1 : +10% sur J

J = 11.11 + 10 = 21.11% ‚úì (garde exactement 21.11%)
Les 8 autres perdent au prorata :
  - Chaque autre : 11.11 - 1.25 = 9.86%
  - Bonus : 11.11 - 1.25 = 9.86% (‚â• 1% OK)
Total = 21.11 + (8 √ó 9.86) = 100% ‚úì
```

**Exemple 2 : Plusieurs boosts**

```
Initial : Tous √† 11.11%
Objet 1 : +10% sur J ‚Üí J = 21.11%, autres = 9.86%
Objet 2 : +20% sur K

K = 9.86 + 20 = 29.86% ‚úì
Les autres (dont J) perdent au prorata :
  - J : 21.11 - 6.03 = 15.08%
  - 6 autres : 9.86 - 2.82 = 7.04%
  - Bonus : max(1%, 9.86 - 2.82) = 7.04%
Total = 29.86 + 15.08 + (7 √ó 7.04) = 100% ‚úì
```

**Exemple 3 : Boost extr√™me**

```
Initial : Tous √† 11.11%
Objet 1 : +95% sur J

J = 11.11 + 95 = 106.11%
Puisque ‚â• 100% :
  J = 99% (ajust√©)
  Tous les autres = 0%
  Bonus = 1% (protection)
Total = 99 + 1 = 100% ‚úì
```

**G√©n√©ration de grille :**

```javascript
// Pour chaque case de la grille :
random = Math.random() √ó 100
cumul = 0

Pour chaque symbole :
  cumul += pourcentage_symbole
  Si random <= cumul :
    s√©lectionner ce symbole
```

**Calcul des gains :**

```javascript
gain = valeur_base_symbole √ó multiplicateur_connexion
```

---

### üí° D√©tails techniques

App dans un seul fichier HTML

- **Technos :**
  - Preact (import via CDN)
  - TailwindCSS (import via CDN)
  - Une lib d'ic√¥nes simple (Lucide ou Heroicons) (import via CDN)
  - Chart.js pour les graphiques (import via CDN)
  - Librairies additionnelles permises pour rendre le code le moins verbose possible (import via CDN)
- **UI :**
  - Interface propre et lisible (en Dashborad pas de scroll si possible sauf simulation)
  - Inputs annot√©s
  - Preview lisible des grilles simul√©es
  - En darkmode (sobre et pro et simple)

---

### üìö Librairies √† importer

#### Tailwind CSS

- **URL :** `https://cdn.tailwindcss.com`
- **Version :** CDN (dernier)
- **M√©thode :** script dans `<head>`

Exemple :

```html
<script src="https://cdn.tailwindcss.com"></script>
```

#### Preact

- **URL :** `https://esm.sh/preact@10.19.3`
- **Version :** 10.19.3
- **M√©thode :** importmap ESM (d√©clar√© dans `<script type="importmap">`) puis import depuis le module principal

Exemple d'importmap :

```html
<script type="importmap">
{
    "imports": {
        "preact": "https://esm.sh/preact@10.19.3",
        "preact/hooks": "https://esm.sh/preact@10.19.3/hooks",
        "htm/preact": "https://esm.sh/htm@3.1.1/preact?external=preact"
    }
}
</script>
```

Exemple d'import dans le module principal :

```javascript
import { h, render } from 'preact';
import { useState, useEffect, useRef } from 'preact/hooks';
import { html } from 'htm/preact';
```

#### Preact hooks

- **URL :** `https://esm.sh/preact@10.19.3/hooks`
- **Version :** 10.19.3
- **M√©thode :** importmap ESM (voir ci-dessus)

#### HTM (Preact integration)

- **URL :** `https://esm.sh/htm@3.1.1/preact?external=preact`
- **Version :** 3.1.1
- **M√©thode :** importmap ESM (voir ci-dessus)

#### Chart.js

- **URL :** `https://cdn.jsdelivr.net/npm/chart.js@4.4.1`
- **Version :** 4.4.1
- **M√©thode :** script classique

Exemple :

```html
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1"></script>
```

#### Lucide (icons)

- **URL :** `https://unpkg.com/lucide@latest`
- **Version :** latest (tag)
- **M√©thode :** script classique

Exemple :

```html
<script src="https://unpkg.com/lucide@latest"></script>
```